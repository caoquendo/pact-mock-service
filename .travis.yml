language: ruby
sudo: required
services:
  - docker
env:
  global:
  - secure: lazBrCVgSna3PWvmUIbungQ6sWufM2MisRbTEmye0jGkoCkaMqJPJzLmy5Juu2NbShiCBo3hjARSxtLcxTCu3xbzAfGae9beatDDPrCCYTlYnterdcfLw/LbTMbEnKj1hr5NFO7Ui5uM4yYDE6pHmuESZ6Js8TYo6yFMPBMyy0FUecOG6+SbE3LNtT1iOzuLib7NMsfYaXrlkTWyEWy4QKsoa49nxvoo4RF67y/E0frchFCCaazsY2XlASR+GG2xsngzV+iAoW0alymju3wWaQLunCJp7QmvbkENfiYmM5HtfWthzCGF+H5XqAqgzwWI/+a16UXw3oZCcg+r9avKPLTzdP/ZO6TghbR6Z9bxDxpQKOo6WNWjg2d2PacRdnnhD6TwHB7tLlb5UPJorarwWcEL1bKN9QN/JceuisubLYyp9eYsLRyo9mi6mTz3pCuV0XH2wBY7ke5nmiSrXBwmDBVUCt4GHnsfgR3iRhelYXLRkwGj5C1IQh8EKWo9OD/kyCqf00o6JEf2/EJapMU7+9hrKgauuodZ256VA4U7jJKoFVTnZYCpnKo2Cu6I+byA2twUyDJjm/2rj8bQDvOpnjzVft+6/o3xyOrffOGm5FxHTXlyivsGyXht07jEdC6nDrUqdywGKONni1IoBdbMSh8xfvR7i4RCuzEVWbbjenw=
  - secure: ZhT2hoVURax4qOiTw9fpelufvhzH4jyHu73+ngzvjbmr9B2xdGXAI+mqZ0miNgVpA6qfAzTGIBXVq8j0kWevSujaVz98LnliImne2MymJTjH39aB5juCB2PcCuekpcYfuhz6CphvYlKG0BFyniGavrlggcAB19s0FHnICqiaPkH74l/c5Jqy2AZUQIDbeXgJ5EXpD1sE27jtqQGwxiro+YQc9HUvad4YcCU+VEmGQRf5kOK01JJ+k3+OwBb+E+LrhrjUmk+wbz4lje4uEgBqyQD+FGuYBvYuge4XeZ4ZZtf2uafrYqZx+8/VvjQ/qqev7W3fjmsLo0i5GAGyeDOz5tMorxtjKddXerQXXfQfi1iZx1xlYhauLflbSRSD93SmEazrencvrSrSxIhQeaHraC/HrCYYiMkwgMu2jRRf9DbLs9GLugMx4HkgpsOR/NxVqBeJw9lTbsYymXOGnHx7daDAjSeRIVSWomrtU1D0DhuLKi2zZ7Zo7ZOvtxjspl/K3uXc1vkoXhTbmcP1lfqy8pj/oDISQ0PO3DqLdPE5VcARM6W6FVqrGRQT+RdsQlhYWtKC63wYgxFAvLj/CMtfkl711J2+IVszZxdMqiRzabsfmHURCb4/QCYjRc0pUeMQCpZzCw0rywQCD64aBbS62YnkI0Cx03JZQcdbqygqVu8=
  - secure: PWAAEWqxTQ0whEvxfR4zQ+58m7hhNUFWZsFv0Mgx/pWMdTt4UEj/IgSKyZhk+wkZtW6w0p1yeKY/08stdd5f18BJXMqAzEpwjYGEfrkMsGzLTogP2X4zypnJdIMdlky2GBP7yweX9UJTkUh4LgcNBngynNyNQtypRRsgIBvtuSMxt+VQ1+iRmRmmKBqJQZlVumeHE2sc6ELRpyDwc/HsUNDRSTqD1hof0eU7LCXoSY/iLU5RO2CW9rYP+lsrpYbRu3OkQF+/NO1BrJ3hb080STh04341phE/Gfof9aQ/ZWgLjvFJYti5lOUqOyqoqzz8DleP5e+AMTKdieek8A0fEVB6ALV4lvJt0dKf5rkmGTWWjOVqutNjfbEuWyKHneWjTckL5JctCY8E0891gpnBynzLIOrhPbkhPAi6fkQ5+NjGK6XeYpLX/i+UZMeWz+Z9DQMFv34WQslEkIXL+QSbb2/2pgRoznMb25FG0A8+GKuCVn33FvgVD7Ejj1iqIMTM02/zHjOY4Lw0YZMgFdsH/Qfo2pH3HlDnLDEOf5znqWk/jm8SsjtgqRhFhj1k2wF/2OcNUxAfakwWpGUm1FR9GL4IDUNDRcKQjLo1BBlW4tCeteXCWQy57bpIgNEUIZN45sJ2hslAd+RAP0H0YcYyrWc+qf/I+pPU+7EwR48S6Ag=
  - COMMIT=${TRAVIS_COMMIT::8}
script: echo "No build necessary."
after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=caoquendo/pact-mock-service
  - export IMAGE_VERSION=`cat Dockerfile | grep PACT_MOCK_SERVICE | sed -n 's/^.*PACT_MOCK_SERVICE "\(.*\)".*$/\1/p'`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$IMAGE_VERSION
  - docker tag $REPO:$COMMIT $REPO:latest
  - docker push $REPO
